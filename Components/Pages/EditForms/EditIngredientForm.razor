@using WebKitchen.Components.SharedComponents
@inject DBService DbService

<div class="row">
    <div class="col-6">
        <EditForm Model="@recipeId">
            <label class="form-label fw-bold">Recipe Id</label>
            <InputNumber id="name" @bind-Value="recipeId" class="form-control"/>

            <button type="submit" class="btn btn-primary" @onclick="HandleSubmit">Get Recipe</button>
        </EditForm>
        @if (currentRecipe != null)
        {
            <PreviewRecipe CurrentPreviewRecipe="@currentRecipe"/>
        }
    </div>


    <div class="col">
        @if (currentRecipe != null)
        {
            <button class="btn btn-primary" @onclick="()=> UpdateIngredients(currentRecipe.RecipeId)" type="button">
                Update ingredients
            </button>

            @foreach (var ingredient in currentRecipe.Ingredients)
            {
                <div style="display:inline-block; margin-right: 10px; padding: 10px;">
                    <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                        @ingredient.Name
                    </button>
                    <ul class="dropdown-menu">
                        <li class="dropdown-item">Calories: @ingredient.CaloriesPer100g.ToString("0")</li>
                        <li class="dropdown-item">Grams: @ingredient.Grams.ToString("0")</li>
                        <li class="dropdown-item">Protein: @ingredient.ProteinPer100g.ToString("0")</li>
                        <li class="dropdown-item">Fat: @ingredient.FatsPer100g.ToString("0")</li>
                        <li class="dropdown-item">Carbs: @ingredient.CarbsPer100g.ToString("0")</li>
                    </ul>
                    <button type="submit" class="btn btn-danger"
                            @onclick="() => DeleteIngredient(currentRecipe.Ingredients.IndexOf(ingredient))">
                        <strong>X</strong>
                    </button>
                </div>
            }
        }
    </div>


</div>

@code{

    int recipeId;
    Recipe? currentRecipe;

    private async Task HandleSubmit()
    {
        currentRecipe = await DbService.GetRecipeById(recipeId);
    }

    private void DeleteIngredient(int index)
    {
        if (currentRecipe != null)
            currentRecipe.Ingredients.RemoveAt(index);
        StateHasChanged();
    }

    private void UpdateIngredients(int recipeId)
    {
    }

}